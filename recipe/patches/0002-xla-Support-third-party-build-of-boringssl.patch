From 3eadf03384f6967042a8f5c48c541cafbf784132 Mon Sep 17 00:00:00 2001
From: "Uwe L. Korn" <uwe.korn@quantco.com>
Date: Thu, 14 Dec 2023 17:06:15 +0100
Subject: [PATCH 2/2] xla: Support third-party build of boringssl

---
 ...pport-third-party-build-of-boringssl.patch | 54 +++++++++++++++++++
 third_party/xla/workspace.bzl                 |  5 +-
 2 files changed, 58 insertions(+), 1 deletion(-)
 create mode 100644 third_party/xla/0001-Support-third-party-build-of-boringssl.patch

diff --git a/third_party/xla/0001-Support-third-party-build-of-boringssl.patch b/third_party/xla/0001-Support-third-party-build-of-boringssl.patch
new file mode 100644
--- /dev/null	(date 1707581089604)
+++ b/third_party/xla/0001-Support-third-party-build-of-boringssl.patch	(date 1707581089604)
@@ -0,0 +1,54 @@
+From b08ec603746c14836a7538220390f9e9d32a7182 Mon Sep 17 00:00:00 2001
+From: "Uwe L. Korn" <uwe.korn@quantco.com>
+Date: Thu, 14 Dec 2023 15:04:51 +0100
+Subject: [PATCH 1/2] Support third-party build of boringssl
+
+---
+ third_party/boringssl.BUILD | 21 +++++++++++++++++++++
+ workspace2.bzl              |  2 +-
+ 2 files changed, 22 insertions(+), 1 deletion(-)
+ create mode 100644 third_party/boringssl.BUILD
+
+diff --git a/third_party/boringssl.BUILD b/third_party/boringssl.BUILD
+new file mode 100644
+index 000000000..bc4c53340
+--- /dev/null
++++ b/third_party/boringssl.BUILD
+@@ -0,0 +1,21 @@
++licenses(["notice"])
++
++filegroup(
++    name = "LICENSE",
++    visibility = ["//visibility:public"],
++)
++
++cc_library(
++    name = "crypto",
++    linkopts = ["-lcrypto"],
++    visibility = ["//visibility:public"],
++)
++
++cc_library(
++    name = "ssl",
++    linkopts = ["-lssl"],
++    visibility = ["//visibility:public"],
++    deps = [
++        ":crypto",
++    ],
++)
+diff --git a/workspace2.bzl b/workspace2.bzl
+index c2f8547b0..9175b68c2 100644
+--- a/workspace2.bzl
++++ b/workspace2.bzl
+@@ -41,7 +41,7 @@ def _tf_repositories():
+         name = "boringssl",
+         sha256 = "9dc53f851107eaf87b391136d13b815df97ec8f76dadb487b58b2fc45e624d2c",
+         strip_prefix = "boringssl-c00d7ca810e93780bd0c8ee4eea28f4f2ea4bcdc",
+-        system_build_file = "//third_party/systemlibs:boringssl.BUILD",
++        system_build_file = "//third_party:boringssl.BUILD",
+         urls = tf_mirror_urls("https://github.com/google/boringssl/archive/c00d7ca810e93780bd0c8ee4eea28f4f2ea4bcdc.tar.gz"),
+     )
+
+--
+2.43.0
+
Index: third_party/xla/workspace.bzl
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/third_party/xla/workspace.bzl b/third_party/xla/workspace.bzl
--- a/third_party/xla/workspace.bzl	(revision 1c68577dcdf70b4c0b42805d279b6a5c04d144fe)
+++ b/third_party/xla/workspace.bzl	(date 1707581141728)
@@ -29,7 +29,11 @@
         sha256 = XLA_SHA256,
         strip_prefix = "xla-{commit}".format(commit = XLA_COMMIT),
         urls = tf_mirror_urls("https://github.com/openxla/xla/archive/{commit}.tar.gz".format(commit = XLA_COMMIT)),
-        patch_file = ["//third_party/xla:log.patch"],
+        patch_file = [
+            "//third_party/xla:log.patch",
+            "//third_party/xla:0001-Support-third-party-build-of-boringssl.patch",
+            "//third_party/xla:0002-Support-third-party-build-of-absl.patch",
+        ],
     )
 
     # For development, one often wants to make changes to the TF repository as well
Index: third_party/xla/0002-Support-third-party-build-of-absl.patch
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/third_party/xla/0002-Support-third-party-build-of-absl.patch b/third_party/xla/0002-Support-third-party-build-of-absl.patch
new file mode 100644
--- /dev/null	(date 1707581391186)
+++ b/third_party/xla/0002-Support-third-party-build-of-absl.patch	(date 1707581391186)
@@ -0,0 +1,13 @@
+diff --git a/WORKSPACE b/WORKSPACE
+--- a/WORKSPACE	(revision a487d8ba5da8d0dec056972270e50de6748a1035)
++++ b/WORKSPACE	(date 1707581277152)
+@@ -25,3 +25,8 @@
+ load(":workspace0.bzl", "xla_workspace0")
+ 
+ xla_workspace0()
++
++local_repository(
++    name = "com_google_absl",
++    path = "$PREFIX/lib",
++)
+\ No newline at end of file
